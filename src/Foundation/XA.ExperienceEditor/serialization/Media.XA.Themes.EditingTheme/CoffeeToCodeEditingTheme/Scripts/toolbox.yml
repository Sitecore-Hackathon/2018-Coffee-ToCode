---
ID: "d08b13a9-45f4-4e70-8c72-e1ca77286d30"
Parent: "8436240f-ddcf-46b6-9eed-b77f76212ba6"
Template: "962b53c4-f93b-4df9-9821-415c867b8903"
Path: /sitecore/media library/Base Themes/CoffeeToCodeEditingTheme/Scripts/toolbox
DB: master
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: "-/media/D08B13A945F44E708C72E1CA77286D30.ashx?h=16&thn=1&w=16"
- ID: "40e50ed9-ba07-4702-992e-a912738d32dc"
  Hint: Blob
  BlobID: "4d4066ec-4951-452b-9d77-79df51c0f2e7"
  Value: aWYgKHR5cGVvZiAoJHhhKSAhPT0gInVuZGVmaW5lZCIpIHsNCiAgICAkeGEudG9vbGJveCA9IChmdW5jdGlvbiAoJCkgew0KICAgICAgICB2YXIgaXRlbXMsDQogICAgICAgICAgICB0cmFuc2xhdGlvbnMsDQogICAgICAgICAgICB0b29sYm94LA0KICAgICAgICAgICAgcHViID0ge30sDQogICAgICAgICAgICAkc2Nyb2xsaW5nID0gJCgnYm9keScpLA0KICAgICAgICAgICAgc2Nyb2xsZXIsDQogICAgICAgICAgICBzY3JvbGxCeSwNCiAgICAgICAgICAgIHJpYmJvbiA9ICQoIiNzY1dlYkVkaXRSaWJib24iKSwNCiAgICAgICAgICAgIHdyYXBwZXIgPSAkKCIjd3JhcHBlciIpLA0KICAgICAgICAgICAgdG91Y2hWZXJzaW9uID0gZmFsc2U7DQoNCiAgICAgICAgdmFyIGdyaXBwZXJJY29uID0gJzxkaXYgY2xhc3M9ImdyaXBwZXItaWNvbiB0b3VjaC1ncmlwcGVyIj4nDQogICAgICAgICAgICArICc8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHg9IjBweCIgeT0iMHB4IiB3aWR0aD0iMzBweCIgaGVpZ2h0PSIzMHB4IiB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNTEyIDUxMjsiIHhtbDpzcGFjZT0icHJlc2VydmUiPicNCiAgICAgICAgICAgICsgJzxnPjxyZWN0IHk9IjE0NCIgd2lkdGg9IjUxMiIgaGVpZ2h0PSIzMiIvPicNCiAgICAgICAgICAgICsgJzxyZWN0IHk9IjI0MCIgd2lkdGg9IjUxMiIgaGVpZ2h0PSIzMiIvPjxyZWN0IHk9IjMzNiIgd2lkdGg9IjUxMiIgaGVpZ2h0PSIzMiIvPjwvZz48L3N2Zz4nDQogICAgICAgICAgICArICc8L2Rpdj4nOw0KDQogICAgICAgIHZhciByZXBsYWNlSWNvbnMgPSBmdW5jdGlvbiAoaWNvbk5hbWUsIGl0ZW1zKSB7DQogICAgICAgICAgICB2YXIgaSwgbCwgY3VycmVudCwgaWNvbjsNCiAgICAgICAgICAgIGZvciAoaSA9IDAsIGwgPSBpdGVtcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsNCiAgICAgICAgICAgICAgICBjdXJyZW50ID0gJChpdGVtc1tpXSk7DQogICAgICAgICAgICAgICAgaWNvbiA9IGN1cnJlbnQuZGF0YShpY29uTmFtZSk7DQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiAoaWNvbikgIT09ICJ1bmRlZmluZWQiKSB7DQogICAgICAgICAgICAgICAgICAgIGN1cnJlbnQuY3NzKCJiYWNrZ3JvdW5kLWltYWdlIiwgInVybCgnIiArIGljb24gKyAiJykiKTsNCiAgICAgICAgICAgICAgICAgICAgY3VycmVudC5jc3MoImJhY2tncm91bmQtcmVwZWF0IiwgIm5vLXJlcGVhdCIpOw0KICAgICAgICAgICAgICAgICAgICBjdXJyZW50LmNzcygiYmFja2dyb3VuZC1wb3NpdGlvbiIsICI1cHggNXB4Iik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KDQogICAgICAgIHZhciBzZXRUb3VjaCA9IGZ1bmN0aW9uIChpc1RvdWNoLCBuZXdUb29sYm94KSB7DQogICAgICAgICAgICBpZiAodHlwZW9mIChuZXdUb29sYm94KSA9PT0gInVuZGVmaW5lZCIgJiYgKHR5cGVvZiAodG9vbGJveCkgPT09ICJ1bmRlZmluZWQiIHx8IHRvb2xib3ggPT0gbnVsbCkpIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmICh0eXBlb2YgKHRvb2xib3gpICE9PSAidW5kZWZpbmVkIiAmJiB0b29sYm94ICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICBpZiAoaXNUb3VjaCkgew0KICAgICAgICAgICAgICAgICAgICB0b29sYm94LmZpbmQoJ2xpIGxpIHNwYW4nKS5kcmFnZ2FibGUoImRpc2FibGUiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHRvb2xib3guZmluZCgnbGkgbGkgc3BhbicpLmRyYWdnYWJsZSgiZW5hYmxlIik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIG5ld1Rvb2xib3ggPSB0b29sYm94Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB2YXIgaXRlbXMgPSBuZXdUb29sYm94LmZpbmQoIiNzeGEtdG9vbGJveC1yb290LXVsIGxpIHNwYW4iKTsNCiAgICAgICAgICAgIGlmIChpc1RvdWNoKSB7DQogICAgICAgICAgICAgICAgJCgiLnVpLXN0YXRlLWRpc2FibGVkIikucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLWRpc2FibGVkIik7DQogICAgICAgICAgICAgICAgcmVwbGFjZUljb25zKCJpY29uMjQiLCBpdGVtcyk7DQogICAgICAgICAgICAgICAgbmV3VG9vbGJveCA9IG5ld1Rvb2xib3guZGV0YWNoKCk7DQogICAgICAgICAgICAgICAgd3JhcHBlci5iZWZvcmUobmV3VG9vbGJveCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXBsYWNlSWNvbnMoImljb24iLCBpdGVtcyk7DQogICAgICAgICAgICAgICAgbmV3VG9vbGJveCA9IG5ld1Rvb2xib3guZGV0YWNoKCk7DQogICAgICAgICAgICAgICAgd3JhcHBlci5iZWZvcmUobmV3VG9vbGJveCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGZpeFBvc2l0aW9uVG9Cb3VuZHMobmV3VG9vbGJveCk7DQoNCiAgICAgICAgfTsNCg0KICAgICAgICBmdW5jdGlvbiBnZXRBbGxvd2VkUmVuZGVyaW5ncygpIHsNCiAgICAgICAgICAgIHZhciBhbGxvd2VkUmVuZGVyaW5ncyA9IFtdLA0KICAgICAgICAgICAgICAgIGNocm9tZXMgPSBTaXRlY29yZS5QYWdlTW9kZXMuQ2hyb21lTWFuYWdlci5jaHJvbWVzKCksDQogICAgICAgICAgICAgICAgaSwgaiwNCiAgICAgICAgICAgICAgICBjaHJvbWU7DQoNCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjaHJvbWVzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgY2hyb21lID0gY2hyb21lc1tpXTsNCiAgICAgICAgICAgICAgICBpZiAoY2hyb21lLmRhdGEgIT09IHVuZGVmaW5lZCAmJiBjaHJvbWUuZGF0YS5jdXN0b20gIT09IHVuZGVmaW5lZCAmJiBjaHJvbWUuZGF0YS5jdXN0b20uYWxsb3dlZFJlbmRlcmluZ3MgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgY2hyb21lUmVuZGVyaW5ncyA9IGNocm9tZS5kYXRhLmN1c3RvbS5hbGxvd2VkUmVuZGVyaW5nczsNCiAgICAgICAgICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IGNocm9tZVJlbmRlcmluZ3MubGVuZ3RoOyBqKyspIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkLmluQXJyYXkoY2hyb21lUmVuZGVyaW5nc1tqXSwgYWxsb3dlZFJlbmRlcmluZ3MpID09PSAtMSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93ZWRSZW5kZXJpbmdzLnB1c2goY2hyb21lUmVuZGVyaW5nc1tqXSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHZhciByZW5kZXJpbmdzID0gW107DQogICAgICAgICAgICBjaHJvbWVzLmZpbHRlcihmdW5jdGlvbiAoZSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBlLmRhdGEuY3VzdG9tICE9IG51bGwgJiYgZS5kYXRhLmN1c3RvbS5lZGl0YWJsZSA9PT0gInRydWUiICYmIGUuZGF0YS5jdXN0b20uYWxsb3dlZFJlbmRlcmluZ3MgIT0gbnVsbCAmJiBlLmRhdGEuY3VzdG9tLmFsbG93ZWRSZW5kZXJpbmdzLmxlbmd0aCA+IDA7DQogICAgICAgICAgICB9KS5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7DQogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlLmRhdGEuY3VzdG9tLmFsbG93ZWRSZW5kZXJpbmdzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50ID0gZS5kYXRhLmN1c3RvbS5hbGxvd2VkUmVuZGVyaW5nc1tpXTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlbmRlcmluZ3MuaW5kZXhPZihjdXJyZW50KSA+PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZW5kZXJpbmdzLnB1c2goY3VycmVudCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICByZXR1cm4gcmVuZGVyaW5nczsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1Yi5sb2FkQ29uZmlndXJhdGlvbiA9IGZ1bmN0aW9uICgpIHsNCg0KICAgICAgICAgICAgdmFyIHEgPSAnP3NjX21vZGU9ZWRpdCc7DQogICAgICAgICAgICB2YXIgc2NTaXRlID0gZ2V0UXVlcnlTdHJpbmdQYXJhbWV0ZXJzKClbInNjX3NpdGUiXTsNCiAgICAgICAgICAgIGlmIChzY1NpdGUpIHsNCiAgICAgICAgICAgICAgICBxICs9ICcmc2Nfc2l0ZT0nICsgc2NTaXRlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkLmFqYXgoew0KICAgICAgICAgICAgICAgIHVybDogJy9+L3N4YS10b29sYm94L3JlbmRlcmluZ3MtZmVlZC8nICsgcSwNCiAgICAgICAgICAgICAgICB0eXBlOiAiUE9TVCIsDQogICAgICAgICAgICAgICAgZGF0YTogew0KICAgICAgICAgICAgICAgICAgICBhbGxvd2VkUmVuZGVyaW5nczogSlNPTi5zdHJpbmdpZnkoZ2V0QWxsb3dlZFJlbmRlcmluZ3MoKSkNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAianNvbiIsDQogICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHsNCiAgICAgICAgICAgICAgICAgICAgaXRlbXMgPSBkYXRhLnJlbmRlcmluZ3M7DQogICAgICAgICAgICAgICAgICAgIHRyYW5zbGF0aW9ucyA9IGRhdGEudHJhbnNsYXRpb25zOw0KICAgICAgICAgICAgICAgICAgICByZWZyZXNoVG9vbGJveCgpOw0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChkYXRhKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZGF0YSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgKTsNCiAgICAgICAgfTsNCg0KICAgICAgICBmdW5jdGlvbiBnZXRRdWVyeVN0cmluZ1BhcmFtZXRlcnMoKSB7DQogICAgICAgICAgICB2YXIgdmFycyA9IFtdLCBoYXNoOw0KICAgICAgICAgICAgdmFyIGhhc2hlcyA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnNsaWNlKHdpbmRvdy5sb2NhdGlvbi5ocmVmLmluZGV4T2YoJz8nKSArIDEpLnNwbGl0KCcmJyk7DQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhhc2hlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgIGhhc2ggPSBoYXNoZXNbaV0uc3BsaXQoJz0nKTsNCiAgICAgICAgICAgICAgICB2YXJzLnB1c2goaGFzaFswXSk7DQogICAgICAgICAgICAgICAgLy92YXJzW2hhc2hbMF1dID0gZGVjb2RlVVJJQ29tcG9uZW50KGhhc2hbMV0pOw0KICAgICAgICAgICAgICAgIHZhcnNbaGFzaFswXV0gPSBoYXNoWzFdOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHZhcnM7DQogICAgICAgIH07DQoNCiAgICAgICAgdmFyIHJlZnJlc2hUb29sYm94ID0gZnVuY3Rpb24gKCkgew0KDQogICAgICAgICAgICAkLnhhTW92ZXIucmVmcmVzaENvbmZpZ3VyYXRpb24oKTsNCg0KICAgICAgICAgICAgdmFyIG5ld1Rvb2xib3ggPSBjcmVhdGVUb29sYm94KCk7DQoNCiAgICAgICAgICAgIGlmICgkLmluQXJyYXkoU2l0ZWNvcmUuUGFnZU1vZGVzLkNhcGFiaWxpdGllcy5kZXNpZ24sIFNpdGVjb3JlLlBhZ2VNb2Rlcy5QYWdlRWRpdG9yLmdldENhcGFiaWxpdGllcygpKSA9PSAtMSkgew0KICAgICAgICAgICAgICAgIG5ld1Rvb2xib3guaGlkZSgpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBhcHBseVRvb2xib3hTZXR0aW5ncyhuZXdUb29sYm94KTsNCg0KICAgICAgICAgICAgaWYgKHRvb2xib3ggPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHdyYXBwZXIuYWZ0ZXIobmV3VG9vbGJveCk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHRvb2xib3gucmVwbGFjZVdpdGgobmV3VG9vbGJveCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHRvb2xib3ggPSBuZXdUb29sYm94Ow0KICAgICAgICAgICAgZml4UG9zaXRpb25Ub0JvdW5kcyh0b29sYm94KTsNCiAgICAgICAgICAgIGluaXRUb29sYm94RXZlbnRzKCk7DQogICAgICAgICAgICB0b29sYm94LmZpbmQoJyNzeGEtdG9vbGJveC1yb290LXVsJykubUN1c3RvbVNjcm9sbGJhcih7DQogICAgICAgICAgICAgICAgdGhlbWU6ICJtaW5pbWFsLWRhcmsiDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICQoZG9jdW1lbnQpLnRyaWdnZXIoInN4YS10b29sYm94LWxvYWRlZCIpOw0KICAgICAgICB9Ow0KDQogICAgICAgIHZhciBjaGVja1RvdWNoID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyICRodG1sID0gJCgiaHRtbCIpOw0KDQogICAgICAgICAgICBpZiAoKCdvbnRvdWNoc3RhcnQnIGluIHdpbmRvdykgfHwNCiAgICAgICAgICAgICAgICAoJ29ubXNnZXN0dXJlY2hhbmdlJyBpbiB3aW5kb3cpICYmDQogICAgICAgICAgICAgICAgKChuYXZpZ2F0b3IubWF4VG91Y2hQb2ludHMgPiAwKSB8fA0KICAgICAgICAgICAgICAgICAgICAobmF2aWdhdG9yLm1zTWF4VG91Y2hQb2ludHMgPiAwKSkpIHsNCiAgICAgICAgICAgICAgICAkaHRtbC5hZGRDbGFzcygiemctdG91Y2giKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCg0KICAgICAgICB2YXIgZ2V0VmlzaWJsZUhlaWdodCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHJldHVybiAkKHdpbmRvdykuaGVpZ2h0KCkgKyAkKHdpbmRvdykuc2Nyb2xsVG9wKCk7DQogICAgICAgIH07DQoNCiAgICAgICAgdmFyIGZpeFBvc2l0aW9uVG9Cb3VuZHMgPSBmdW5jdGlvbiAodG9vbGJveCkgew0KICAgICAgICAgICAgLy9maXggdG91Y2ggZXhwYW5kZXINCiAgICAgICAgICAgIHZhciBleHBhbmRlcjsNCg0KDQogICAgICAgICAgICBpZiAodG9vbGJveC5pcygiLnRvdWNoLXZlcnNpb24iKSkgew0KICAgICAgICAgICAgICAgIGV4cGFuZGVyID0gdG9vbGJveC5maW5kKCIudG91Y2gtZXhwYW5kZXIiKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgZXhwYW5kZXIgPSB0b29sYm94LmZpbmQoIi5ub3JtYWwtZXhwYW5kZXIiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGV4cGFuZGVyLmNzcygidG9wIiwgJCh3aW5kb3cpLmhlaWdodCgpIC8gMiAtIHJpYmJvbi5oZWlnaHQoKSArIGV4cGFuZGVyLmhlaWdodCgpICsgInB4Iik7DQogICAgICAgICAgICBmaXhIZWlnaHQodG9vbGJveCk7DQogICAgICAgIH07DQoNCiAgICAgICAgdmFyIGZpeEhlaWdodCA9IGZ1bmN0aW9uIChqUVRvb2xib3gpIHsNCiAgICAgICAgICAgIHZhciBoZWlnaHQsIHJvb3RVbCA9IGpRVG9vbGJveC5maW5kKCIjc3hhLXRvb2xib3gtcm9vdC11bCIpOw0KICAgICAgICAgICAgaWYgKGpRVG9vbGJveC5oYXNDbGFzcygidG91Y2gtdmVyc2lvbiIpKSB7DQogICAgICAgICAgICAgICAgaGVpZ2h0ID0galFUb29sYm94LmhlaWdodCgpIC0gcmliYm9uLmhlaWdodCgpIC0gNzA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBoZWlnaHQgPSBnZXRWaXNpYmxlSGVpZ2h0KCkgLSBqUVRvb2xib3gub2Zmc2V0KCkudG9wIC0gNTA7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJvb3RVbC5jc3MoImhlaWdodCIsIGhlaWdodCk7DQogICAgICAgIH07DQoNCiAgICAgICAgdmFyIGNyZWF0ZVRvb2xib3ggPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgbmV3VG9vbGJveCA9ICQoJzxkaXYgaWQ9InN4YS10b29sYm94Ij4nKSwNCiAgICAgICAgICAgICAgICB0b29sYm94U2V0dGluZ3MgPSBnZXRDb29raWUoJ3N4YS10b29sYm94Jyk7DQogICAgICAgICAgICBuZXdUb29sYm94LmFkZENsYXNzKCdtQ3VzdG9tU2Nyb2xsYmFyJyk7DQogICAgICAgICAgICB0b29sYm94U2V0dGluZ3MgPSB0b29sYm94U2V0dGluZ3MubWF0Y2goL1tefF0rL2cpOw0KDQogICAgICAgICAgICBuZXdUb29sYm94Lmh0bWwoJzxkaXYgY2xhc3M9InRvdWNoLWhlYWRlciBzeGEtdG9vbGJveC1oZWFkZXIiPicgKw0KICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJzeGEtdG9vbGJveC1sYWJlbCI+JyArIHRyYW5zbGF0aW9ucy5Ub29sYm94ICsgJzwvZGl2PicNCiAgICAgICAgICAgICAgICArICc8ZGl2IGNsYXNzPSJ0b3VjaC1idG4gYmFjay10by1kZXNrdG9wIj48L2Rpdj4nDQogICAgICAgICAgICAgICAgKyAnPC9kaXY+PGRpdiBjbGFzcz0idG91Y2gtZXhwYW5kZXIiPjwvZGl2PjxkaXYgY2xhc3M9Im5vcm1hbC1leHBhbmRlciI+PC9kaXY+Jw0KICAgICAgICAgICAgICAgICsgJzxkaXYgY2xhc3M9ImhhbmRsZSBzeGEtdG9vbGJveC1oZWFkZXIiPicgKyAnPGRpdiBjbGFzcz0ic3hhLXRvb2xib3gtbGFiZWwiPicgKyB0cmFuc2xhdGlvbnMuVG9vbGJveCArICc8L2Rpdj4nICsgJzxkaXYgY2xhc3M9ImV4cGFuZC10b29sYm94Ij48L2Rpdj48L2Rpdj4nKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgdmFyIHNlYXJjaEJveCA9ICQoJzxpbnB1dCBwbGFjZWhvbGRlcj0iU2VhcmNoIGNvbnRyb2xzIC4uLiIgc3R5bGU9IndpZHRoOjEwMCU7cGFkZGluZzozcHggNnB4IiAvPicpOw0KDQogICAgICAgICAgICBuZXdUb29sYm94LmFwcGVuZCgkKCc8ZGl2IGlkPSJzeGEtc2VhcmNoLWJveCI+PC9kaXY+JykuYXBwZW5kKHNlYXJjaEJveCkpOw0KDQogICAgICAgICAgICB2YXIgdWxGaXJzdCA9ICQoJzxkaXYgaWQ9InN4YS10b29sYm94LXJvb3QtdWwiPicpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBzZWFyY2hCb3gua2V5dXAoZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQudmFsdWUubGVuZ3RoICYmIGUudGFyZ2V0LnZhbHVlLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgdWxGaXJzdC5maW5kKCdbaWRePXN4YS10b29sYm94LXNlY3Rpb25dJykuZWFjaChmdW5jdGlvbihpbmRleCwgZWwpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJHRoaXMuaGFzQ2xhc3MoJ2V4cGFuZGVkJykpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5hZGRDbGFzcygnZXhwYW5kZWQnKS5hZGRDbGFzcygndGVtcC1leHBhbmRlZCcpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLnBhcmVudCgpLmZpbmQoJ3VsJykuc2xpZGVEb3duKCJmYXN0Iik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZVRvb2xib3hTZXR0aW5ncygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICB1bEZpcnN0LmZpbmQoJ1tpZF49c3hhLXRvb2xib3gtc2VjdGlvbl0nKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgZWwpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy5oYXNDbGFzcygndGVtcC1leHBhbmRlZCcpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMucmVtb3ZlQ2xhc3MoJ3RlbXAtZXhwYW5kZWQnKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy5oYXNDbGFzcygnZXhwYW5kZWQnKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5yZW1vdmVDbGFzcygnZXhwYW5kZWQnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMucGFyZW50KCkuZmluZCgndWwnKS5zbGlkZVVwKCJmYXN0Iik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVUb29sYm94U2V0dGluZ3MoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHVsRmlyc3QuZmluZCgnLnVpLWRyYWdnYWJsZScpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBlbCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgJGVsID0gJChlbCk7DQogICAgICAgICAgICAgICAgICAgIGlmICgkZWwudGV4dCgpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihlLnRhcmdldC52YWx1ZS50b0xvd2VyQ2FzZSgpKSA+IC0xKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkZWwucGFyZW50KCdsaScpLnNob3coKTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRlbC5wYXJlbnQoJ2xpJykuaGlkZSgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9LCApOw0KDQogICAgICAgICAgICB2YXIgcHJldmlvdXNQYXJlbnQgPSAnJzsNCiAgICAgICAgICAgIHZhciB1bFNlY29uZCA9ICcnIDsNCiAgICAgICAgICAgIGlmIChpdGVtcyA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRvb2xib3g7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IGl0ZW1zW2ldOw0KICAgICAgICAgICAgICAgIGlmICgkLmluQXJyYXkoaXRlbS5JRCwgJHhhLnhhTW92ZXIuYWxsb3dlZFJlbmRlcmluZ3MpICE9IC0xKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChwcmV2aW91c1BhcmVudCAhPSBpdGVtLlBhcmVudCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcHJldmlvdXNQYXJlbnQgPSBpdGVtLlBhcmVudDsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsaUZpcnN0ID0gJCgnPGRpdj4nKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxpRmlyc3QuaHRtbCgnPHNwYW4gaWQ9InN4YS10b29sYm94LXNlY3Rpb24tJyArIGl0ZW0uUGFyZW50LnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvW15hLXpcLV0vLCAnJykgKyAnIj4nICsgaXRlbS5QYXJlbnQgKyAnPC9zcGFuPicpOw0KICAgICAgICAgICAgICAgICAgICAgICAgdWxGaXJzdC5hcHBlbmQobGlGaXJzdCk7DQogICAgICAgICAgICAgICAgICAgICAgICB1bFNlY29uZCA9ICQoJzx1bD4nKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxpRmlyc3QuYXBwZW5kKHVsU2Vjb25kKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB2YXIgbGlTZWNvbmQgPSAkKCc8bGk+PHNwYW4gZGF0YS1pY29uPSInICsgaXRlbS5JY29uICsgJyIgZGF0YS1pY29uMjQ9IicgKyBpdGVtLkljb24yNCArICciIGRhdGEtaWQ9IicgKyBpdGVtLklEICsgJyIgc3R5bGU9ImJhY2tncm91bmQ6IHVybCgnICsgaXRlbS5JY29uICsgJykgbm8tcmVwZWF0IDVweCA1cHg7Ij4nICsgaXRlbS5OYW1lICsgJzwvc3Bhbj48L3NwYW4+PC9kaXY+Jyk7DQogICAgICAgICAgICAgICAgICAgIGxpU2Vjb25kLnByZXBlbmQoJChncmlwcGVySWNvbikpOw0KICAgICAgICAgICAgICAgICAgICB1bFNlY29uZC5hcHBlbmQobGlTZWNvbmQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKHVsRmlyc3QuY2hpbGRyZW4oKS5sZW5ndGggPT0gMCkgew0KICAgICAgICAgICAgICAgIHVsRmlyc3QuaHRtbCgnPGRpdiBjbGFzcz0ic3hhLXRvb2xib3gtZW1wdHkiPicgKyB0cmFuc2xhdGlvbnMuTm9SZW5kZXJpbmdzICsgJzwvZGl2PicpOw0KICAgICAgICAgICAgICAgIG5ld1Rvb2xib3guZmluZCgnLmhpZGUtdG9vbGJveCcpLmFkZENsYXNzKCdzaG93LXRvb2xib3gnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIG5ld1Rvb2xib3guYXBwZW5kKHVsRmlyc3QpOw0KDQogICAgICAgICAgICBpZiAoY2hlY2tUb3VjaCgpKSB7DQogICAgICAgICAgICAgICAgLy9jaGVjayBpZiB0b29sYm94IG1vZGUgc2V0IGluIGNvb2tpZQ0KICAgICAgICAgICAgICAgIGlmICghdG9vbGJveFNldHRpbmdzIHx8IHRvb2xib3hTZXR0aW5nc1s0XSA9PSAidHJ1ZSIpIHsNCiAgICAgICAgICAgICAgICAgICAgbmV3VG9vbGJveC5hZGRDbGFzcygidG91Y2gtdmVyc2lvbiIpOw0KICAgICAgICAgICAgICAgICAgICBzZXRUb3VjaCh0cnVlKTsNCiAgICAgICAgICAgICAgICAgICAgdG91Y2hWZXJzaW9uID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gbmV3VG9vbGJveDsNCiAgICAgICAgfTsNCg0KICAgICAgICB2YXIgc2F2ZVRvb2xib3hTZXR0aW5ncyA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBjb2xsYXBzZWQgPSB0b29sYm94Lmhhc0NsYXNzKCdzaG93LXRvb2xib3gnKSA/IDAgOiAxLA0KICAgICAgICAgICAgICAgIGxlZnQgPSB0b29sYm94LmNzcygnbGVmdCcpLA0KICAgICAgICAgICAgICAgIHRvcCA9IHRvb2xib3guY3NzKCd0b3AnKSwNCiAgICAgICAgICAgICAgICBzZWN0aW9ucyA9IG51bGw7DQoNCiAgICAgICAgICAgIHZhciBleHBhbmRlZFNwYW5zID0gdG9vbGJveC5maW5kKCdzcGFuLmV4cGFuZGVkJyk7DQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGV4cGFuZGVkU3BhbnMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICBzZWN0aW9ucyArPSAnLCcgKyAkKGV4cGFuZGVkU3BhbnNbaV0pLmF0dHIoJ2lkJyk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmICh0b3VjaFZlcnNpb24pIHsNCiAgICAgICAgICAgICAgICB2YXIgdG9vbGJveFNldHRpbmdzID0gZ2V0Q29va2llKCdzeGEtdG9vbGJveCcpOw0KICAgICAgICAgICAgICAgIHRvb2xib3hTZXR0aW5ncyA9IHRvb2xib3hTZXR0aW5ncy5tYXRjaCgvW158XSsvZyk7DQogICAgICAgICAgICAgICAgaWYgKHRvb2xib3hTZXR0aW5ncyAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIGxlZnQgPSB0b29sYm94U2V0dGluZ3NbMV07DQogICAgICAgICAgICAgICAgICAgIHRvcCA9IHRvb2xib3hTZXR0aW5nc1syXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGRvY3VtZW50LmNvb2tpZSA9ICdzeGEtdG9vbGJveD0nICsgY29sbGFwc2VkICsgJ3wnICsgbGVmdCArICd8JyArIHRvcCArICd8JyArIHNlY3Rpb25zICsgJ3wnICsgdG91Y2hWZXJzaW9uOw0KICAgICAgICB9Ow0KDQogICAgICAgIHZhciBzYXZlVG9vbGJveFNldHRpbmdzUGFydCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciB0b29sYm94U2V0dGluZ3MgPSBnZXRDb29raWUoJ3N4YS10b29sYm94Jyk7DQoNCiAgICAgICAgICAgIGlmICh0b29sYm94U2V0dGluZ3MpIHsNCiAgICAgICAgICAgICAgICB0b29sYm94U2V0dGluZ3MgPSB0b29sYm94U2V0dGluZ3MubWF0Y2goL1tefF0rL2cpOw0KICAgICAgICAgICAgICAgIGlmICh0b29sYm94U2V0dGluZ3MgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5jb29raWUgPSAnc3hhLXRvb2xib3g9JyArIHRvb2xib3hTZXR0aW5nc1swXSArICd8JyArIHRvb2xib3hTZXR0aW5nc1sxXSArICd8JyArIHRvb2xib3hTZXR0aW5nc1syXSArICd8JyArIHRvb2xib3hTZXR0aW5nc1szXSArICd8JyArIHRvdWNoVmVyc2lvbjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH07DQoNCiAgICAgICAgdmFyIGFwcGx5VG9vbGJveFNldHRpbmdzID0gZnVuY3Rpb24gKHRoZVRvb2xib3gpIHsNCiAgICAgICAgICAgIHZhciB0b29sYm94U2V0dGluZ3MgPSBnZXRDb29raWUoJ3N4YS10b29sYm94Jyk7DQoNCiAgICAgICAgICAgIGlmICh0b29sYm94U2V0dGluZ3MpIHsNCiAgICAgICAgICAgICAgICB0b29sYm94U2V0dGluZ3MgPSB0b29sYm94U2V0dGluZ3MubWF0Y2goL1tefF0rL2cpOw0KDQoNCiAgICAgICAgICAgICAgICAvL2NoZWNrIGlmIGNvbGxhcHNlZA0KICAgICAgICAgICAgICAgIGlmIChwYXJzZUludCh0b29sYm94U2V0dGluZ3NbMF0pID09PSAwKSB7DQogICAgICAgICAgICAgICAgICAgIHRoZVRvb2xib3guYWRkQ2xhc3MoInNob3ctdG9vbGJveCIpOw0KICAgICAgICAgICAgICAgICAgICB0aGVUb29sYm94LmZpbmQoJy5oaWRlLXRvb2xib3gnKS5hZGRDbGFzcygnc2hvdy10b29sYm94Jyk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLy9jaGVjayBleHBhbmRlZCBzZWN0aW9ucw0KICAgICAgICAgICAgICAgIGlmICh0b29sYm94U2V0dGluZ3NbM10pIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGV4cGFuZGVkU2VjdGlvbnMgPSB0b29sYm94U2V0dGluZ3NbM10ubWF0Y2goL1teLF0rL2cpOw0KICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGV4cGFuZGVkU2VjdGlvbnMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzZWN0aW9uID0gdGhlVG9vbGJveC5maW5kKCcjJyArIGV4cGFuZGVkU2VjdGlvbnNbaV0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgc2VjdGlvbi5hZGRDbGFzcygnZXhwYW5kZWQnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlY3Rpb24ucGFyZW50KCkuZmluZCgndWwnKS5zaG93KCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAvL2NoZWNrIG1vZGUgKHRvdWNoL25vcm1hbCkNCiAgICAgICAgICAgICAgICBpZiAodG9vbGJveFNldHRpbmdzWzRdID09ICJ0cnVlIikgew0KICAgICAgICAgICAgICAgICAgICB0b3VjaFZlcnNpb24gPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAkKCJodG1sIikuYWRkQ2xhc3MoInpnLXRvdWNoIik7DQogICAgICAgICAgICAgICAgICAgIHRoZVRvb2xib3guYWRkQ2xhc3MoInRvdWNoLXZlcnNpb24iKTsNCiAgICAgICAgICAgICAgICAgICAgc2V0VG91Y2godHJ1ZSk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJCgiaHRtbCIpLnJlbW92ZUNsYXNzKCJ6Zy10b3VjaCIpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHNldFRvdWNoKHRvdWNoVmVyc2lvbiwgdGhlVG9vbGJveCk7DQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICB9Ow0KDQogICAgICAgIHZhciBjaGVja1dyYXBwZXJQb3NpdGlvbiA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGlmICh0b29sYm94LndpZHRoKCkgKyAkKCIjd3JhcHBlciIpLndpZHRoKCkgPCAkKHdpbmRvdykud2lkdGgoKSkgew0KICAgICAgICAgICAgICAgIHRvb2xib3guYWRkQ2xhc3MoInRvb2xib3gtd3JhcHBlci1oYWxmIik7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHRvb2xib3gucmVtb3ZlQ2xhc3MoInRvb2xib3gtd3JhcHBlci1oYWxmIik7DQogICAgICAgICAgICB9DQogICAgICAgIH07DQoNCiAgICAgICAgdmFyIHRvZ2dsZVRvb2xib0xvY2sgPSBmYWxzZTsNCg0KICAgICAgICB2YXIgaW5pdFRvb2xib3hFdmVudHMgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgaGFuZGxlID0gdG9vbGJveC5maW5kKCIuaGFuZGxlIiksDQogICAgICAgICAgICAgICAgcmliYm9uU3dpdGNoZXIgPSByaWJib24uY29udGVudHMoKS5maW5kKCJuYXYgPiBbZGF0YS1zYy1pZD0nUXVpY2tSaWJib24nXSIpIHx8IHJpYmJvbi5jb250ZW50cygpLmZpbmQoIi5zYy1xdWlja2Jhci1pdGVtLnNjLXF1aWNrYmFyLWJ1dHRvbi5zY19RdWlja2JhckJ1dHRvbl81NiIpOw0KDQoNCiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgZml4UG9zaXRpb25Ub0JvdW5kcyh0b29sYm94KTsNCiAgICAgICAgICAgIH0pOw0KDQoNCiAgICAgICAgICAgIHJpYmJvblN3aXRjaGVyLm9uKCJjbGljayIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBmaXhQb3NpdGlvblRvQm91bmRzKHRvb2xib3gpOw0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgIHRvb2xib3gub24oInRyYW5zaXRpb25lbmQgd2Via2l0VHJhbnNpdGlvbkVuZCBvVHJhbnNpdGlvbkVuZCBNU1RyYW5zaXRpb25FbmQiLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgU2l0ZWNvcmUuUGFnZU1vZGVzLkNocm9tZUhpZ2hsaWdodE1hbmFnZXIuaGlnaGxpZ2h0Q2hyb21lcygpOw0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgIHZhciB0b2dnbGVUb29sYm94U2hvdyA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBpZiAodG9nZ2xlVG9vbGJvTG9jaykgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHRvZ2dsZVRvb2xib0xvY2sgPSB0cnVlOw0KICAgICAgICAgICAgICAgIGNoZWNrV3JhcHBlclBvc2l0aW9uKCk7DQogICAgICAgICAgICAgICAgJCh0aGlzKS50b2dnbGVDbGFzcygnc2hvdy10b29sYm94Jyk7DQogICAgICAgICAgICAgICAgdG9vbGJveC50b2dnbGVDbGFzcygnc2hvdy10b29sYm94Jyk7DQogICAgICAgICAgICAgICAgZml4SGVpZ2h0KHRvb2xib3gpOw0KICAgICAgICAgICAgICAgIHNhdmVUb29sYm94U2V0dGluZ3MoKTsNCg0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGZ1bmMoKSB7DQogICAgICAgICAgICAgICAgICAgIHRvZ2dsZVRvb2xib0xvY2sgPSBmYWxzZTs7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuYywgMTApOw0KICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgdG9vbGJveC5maW5kKCcuaGlkZS10b29sYm94Jykub24oImNsaWNrIiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHRvZ2dsZVRvb2xib3hTaG93KCk7DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgdG9vbGJveC5maW5kKCcubm9ybWFsLWV4cGFuZGVyJykub24oImNsaWNrIiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHRvZ2dsZVRvb2xib3hTaG93KCk7DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgdG9vbGJveC5maW5kKCIudG91Y2gtZXhwYW5kZXIiKS5vbigiY2xpY2sgdG91Y2hzdGFydCBwb2ludGVyZG93biBNU1BvaW50ZXJEb3duIiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHRvZ2dsZVRvb2xib3hTaG93KCk7DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgdG9vbGJveC5maW5kKCcjc3hhLXRvb2xib3gtcm9vdC11bCBkaXYgc3BhbicpLmNsaWNrKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCdleHBhbmRlZCcpOw0KICAgICAgICAgICAgICAgICQodGhpcykucGFyZW50KCkuZmluZCgndWwnKS5zbGlkZVRvZ2dsZSgiZmFzdCIpOw0KICAgICAgICAgICAgICAgIHNhdmVUb29sYm94U2V0dGluZ3MoKTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICB2YXIgdG9nZ2xlVG9vbGJveFRvdWNoID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIGlmICh0b2dnbGVUb29sYm9Mb2NrKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdG9nZ2xlVG9vbGJvTG9jayA9IHRydWU7DQogICAgICAgICAgICAgICAgdG9vbGJveC50b2dnbGVDbGFzcygidG91Y2gtdmVyc2lvbiIpOw0KICAgICAgICAgICAgICAgIHNldFRvdWNoKHRvb2xib3guaXMoInRvdWNoLXZlcnNpb24iKSk7DQogICAgICAgICAgICAgICAgdG91Y2hWZXJzaW9uID0gIXRvdWNoVmVyc2lvbjsNCiAgICAgICAgICAgICAgICBmaXhIZWlnaHQodG9vbGJveCk7DQogICAgICAgICAgICAgICAgc2F2ZVRvb2xib3hTZXR0aW5nc1BhcnQoKTsNCiAgICAgICAgICAgICAgICBhcHBseVRvb2xib3hTZXR0aW5ncyh0b29sYm94KTsNCiAgICAgICAgICAgICAgICBmaXhQb3NpdGlvblRvQm91bmRzKHRvb2xib3gpOw0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGZ1bmMoKSB7DQogICAgICAgICAgICAgICAgICAgIHRvZ2dsZVRvb2xib0xvY2sgPSBmYWxzZTs7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuYywgMTAwKTsNCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIHRvb2xib3guZmluZCgiLmJhY2stdG8tZGVza3RvcCIpLm9uKCJjbGljayB0b3VjaHN0YXJ0IHBvaW50ZXJkb3duIE1TUG9pbnRlckRvd24iLCBmdW5jdGlvbiAoYXJncykgew0KICAgICAgICAgICAgICAgIGFyZ3MucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgICAgICB0b29sYm94LnJlbW92ZUNsYXNzKCJ0b3VjaC12ZXJzaW9uIik7DQogICAgICAgICAgICAgICAgc2V0VG91Y2godG9vbGJveC5pcygidG91Y2gtdmVyc2lvbiIpKTsNCiAgICAgICAgICAgICAgICB0b3VjaFZlcnNpb24gPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBmaXhIZWlnaHQodG9vbGJveCk7DQogICAgICAgICAgICAgICAgc2F2ZVRvb2xib3hTZXR0aW5nc1BhcnQoKTsNCiAgICAgICAgICAgICAgICBhcHBseVRvb2xib3hTZXR0aW5ncyh0b29sYm94KTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICB0b29sYm94LmZpbmQoIi5leHBhbmQtdG9vbGJveCIpLm9uKCJjbGljayB0b3VjaHN0YXJ0IHBvaW50ZXJkb3duIE1TUG9pbnRlckRvd24iLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgdG9nZ2xlVG9vbGJveFRvdWNoKCk7DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgdmFyIGhhbmRsZXIgPSBmdW5jdGlvbiAoZXZlbnRTdGFydCkgew0KICAgICAgICAgICAgICAgIHZhciBwb3NYLA0KICAgICAgICAgICAgICAgICAgICBwb3NYRW5kOw0KDQogICAgICAgICAgICAgICAgaWYgKGV2ZW50U3RhcnQub3JpZ2luYWxFdmVudC5oYXNPd25Qcm9wZXJ0eSgidG91Y2hlcyIpKSB7DQogICAgICAgICAgICAgICAgICAgIHBvc1ggPSBldmVudFN0YXJ0Lm9yaWdpbmFsRXZlbnQudG91Y2hlc1swXS5wYWdlWDsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBwb3NYID0gZXZlbnRTdGFydC5vcmlnaW5hbEV2ZW50LnBhZ2VYOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICRzY3JvbGxpbmcudW5iaW5kKCIuZXYzIik7DQogICAgICAgICAgICAgICAgJHNjcm9sbGluZy5vbigidG91Y2hlbmQuZXYzIHBvaW50ZXJ1cC5ldjMgTVNQb2ludGVyVXAuZXYzIiwgZnVuY3Rpb24gKGV2ZW50RW5kKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICh0b3VjaFZlcnNpb24pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudEVuZC5vcmlnaW5hbEV2ZW50Lmhhc093blByb3BlcnR5KCJjaGFuZ2VkVG91Y2hlcyIpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zWEVuZCA9IGV2ZW50RW5kLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVg7DQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc1hFbmQgPSBldmVudEVuZC5vcmlnaW5hbEV2ZW50LnBhZ2VYOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHBvc1ggPCAyMCkgJiYgKHBvc1ggPCBwb3NYRW5kKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdG9vbGJveC5oYXNDbGFzcygic2hvdy10b29sYm94IikpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJveC5hZGRDbGFzcygnc2hvdy10b29sYm94Jyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVUb29sYm94U2V0dGluZ3MoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgICRzY3JvbGxpbmcub24oInRvdWNoc3RhcnQiLCBoYW5kbGVyKTsNCiAgICAgICAgICAgIGhhbmRsZS5vbigicG9pbnRlcmRvd24gTVNQb2ludGVyRG93IiwgaGFuZGxlcik7DQogICAgICAgICAgICB2YXIgY2FjaGVkRHJhZ2dhYmxlOw0KICAgICAgICAgICAgdmFyIGRyYWdnZXIgPSB7DQogICAgICAgICAgICAgICAgb3BhY2l0eTogMC43LA0KICAgICAgICAgICAgICAgIHNjcm9sbDogdHJ1ZSwNCiAgICAgICAgICAgICAgICBoZWxwZXI6ICJjbG9uZSIsDQogICAgICAgICAgICAgICAgY29udGFpbm1lbnQ6ICdodG1sJywNCiAgICAgICAgICAgICAgICBhcHBlbmRUbzogJyN3cmFwcGVyJywNCiAgICAgICAgICAgICAgICBjdXJzb3JBdDogeyB0b3A6IC0yMCwgbGVmdDogMjAgfSwNCiAgICAgICAgICAgICAgICByZWZyZXNoUG9zaXRpb25zOiB0cnVlLA0KICAgICAgICAgICAgICAgIHN0YXJ0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgICQoJy51aS1kcmFnZ2FibGUtZHJhZ2dpbmcnKS5hZGRDbGFzcygndG9vbGJveC1pdGVtJyk7DQogICAgICAgICAgICAgICAgICAgIGlmICh0b3VjaFZlcnNpb24pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICQoJy51aS1kcmFnZ2FibGUtZHJhZ2dpbmcnKS5hZGRDbGFzcygndG91Y2gtZHJhZ2dhYmxlJyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgJC54YU1vdmVyLnByZXBhcmVEcm9wcGFibGVQbGFjZWhvbGRlcnMoJCh0aGlzKSwgdG9vbGJveCk7DQoNCiAgICAgICAgICAgICAgICAgICAgY2FjaGVkRHJhZ2dhYmxlID0gJCgiLnVpLWRyYWdnYWJsZS1kcmFnZ2luZyIpOw0KICAgICAgICAgICAgICAgICAgICBjYWNoZWREcmFnZ2FibGUucmVmcmVzaENvdW50ZXIgPSAwOw0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgc3RvcDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICQueGFNb3Zlci5jbGVhckRyb3BwYWJsZVBsYWNlaG9sZGVycygpOw0KICAgICAgICAgICAgICAgICAgICB9LCA1MCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgdG9vbGJveC5maW5kKCcjc3hhLXRvb2xib3gtcm9vdC11bCBsaSBzcGFuJykuZHJhZ2dhYmxlKGRyYWdnZXIpOw0KDQogICAgICAgICAgICAvL2RyYWdnZXIgZm9yIHRvdWNoIGdyaXBwZXINCiAgICAgICAgICAgIHZhciB0b3VjaERyYWdnZXIgPSAkLmV4dGVuZCh7fSwgZHJhZ2dlcik7DQogICAgICAgICAgICB0b3VjaERyYWdnZXIuaGVscGVyID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHZhciBzZWxmID0gJCh0aGlzKTsNCiAgICAgICAgICAgICAgICB2YXIgaGVscGVyID0gc2VsZi5zaWJsaW5ncygic3BhbiIpOw0KICAgICAgICAgICAgICAgIHNlbGYuZGF0YSgiaWQiLCBoZWxwZXIuZGF0YSgiaWQiKSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIGhlbHBlci5jbG9uZSgpOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIHRvdWNoRHJhZ2dlci5zdGFydCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICB2YXIgaGVscGVyID0gJCh0aGlzKS5zaWJsaW5ncygic3BhbiIpOw0KICAgICAgICAgICAgICAgIGRyYWdnZXIuc3RhcnQuY2FsbChoZWxwZXJbMF0pOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIHRvb2xib3guZmluZCgiLnRvdWNoLWdyaXBwZXIiKS5kcmFnZ2FibGUodG91Y2hEcmFnZ2VyKTsNCiAgICAgICAgICAgIHNldFRvdWNoKHRvdWNoVmVyc2lvbik7DQogICAgICAgIH07DQoNCiAgICAgICAgLy9leHRlbmRzIGpRdWVyeS54YU1vdmVyLmNsZWFudXANCiAgICAgICAgdmFyIGNsZWFudXAgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBwdWIubG9hZENvbmZpZ3VyYXRpb24oKTsNCiAgICAgICAgICAgIH0sIDEpOw0KICAgICAgICB9Ow0KDQogICAgICAgIHZhciBnZXRDb29raWUgPSBmdW5jdGlvbiAoY25hbWUpIHsNCiAgICAgICAgICAgIHZhciBuYW1lID0gY25hbWUgKyAiPSI7DQogICAgICAgICAgICB2YXIgY2EgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoJzsnKTsNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2EubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICB2YXIgYyA9IGNhW2ldLnRyaW0oKTsNCiAgICAgICAgICAgICAgICBpZiAoYy5pbmRleE9mKG5hbWUpID09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMuc3Vic3RyaW5nKG5hbWUubGVuZ3RoLCBjLmxlbmd0aCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuICIiOw0KICAgICAgICB9Ow0KDQogICAgICAgIHB1Yi5pbml0ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgaWYgKHRvb2xib3ggPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgU2l0ZWNvcmUgPT09ICJ1bmRlZmluZWQiIHx8IHR5cGVvZiAkKGRvY3VtZW50KS5kcmFnZ2FibGUgPT09ICJ1bmRlZmluZWQiIHx8IHR5cGVvZiAoJC54YU1vdmVyKSA9PT0gInVuZGVmaW5lZCIpDQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCg0KICAgICAgICAgICAgICAgIHB1Yi5sb2FkQ29uZmlndXJhdGlvbigpOw0KICAgICAgICAgICAgICAgIFNpdGVjb3JlLlBhZ2VNb2Rlcy5DaHJvbWVNYW5hZ2VyLmNocm9tZXNSZXNldGVkLm9ic2VydmUoJHNjLnByb3h5KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgY2xlYW51cCgpOw0KICAgICAgICAgICAgICAgIH0pKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCg0KICAgICAgICBwdWIucmVtb3ZlID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdG9vbGJveCA9IG51bGw7DQogICAgICAgICAgICAkKCcjc3hhLXRvb2xib3gnKS51bmJpbmQoKS5yZW1vdmUoKTsNCiAgICAgICAgfTsNCg0KICAgICAgICBwdWIuaGFuZGxlUmVzcG9uc2UgPSBmdW5jdGlvbiAobWVzc2FnZSwgcmVzdWx0KSB7DQogICAgICAgICAgICBpZiAobWVzc2FnZSAhPSAnY2hyb21lOnBsYWNlaG9sZGVyOmNvbnRyb2xhZGRpbmdjYW5jZWxsZWQnKSB7DQogICAgICAgICAgICAgICAgJC54YU1vdmVyLmN1cnJlbnRDaHJvbWUudHlwZS5hZGRDb250cm9sUmVzcG9uc2UocmVzdWx0LmlkLCByZXN1bHQub3BlblByb3BlcnRpZXMsIHJlc3VsdC5kYXRhU291cmNlKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgJC54YU1vdmVyLmNsZWFudXAoKTsNCiAgICAgICAgICAgICAgICBjbGVhbnVwKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH07DQoNCiAgICAgICAgcmV0dXJuIHB1YjsNCiAgICB9KCR4YSkpOw0KfQ==
- ID: "6954b7c7-2487-423f-8600-436cb3b6dc0e"
  Hint: Size
  Value: 23506
- ID: "6f47a0a5-9c94-4b48-abeb-42d38def6054"
  Hint: Mime Type
  Value: "application/x-javascript"
- ID: "c06867fe-9a43-4c7d-b739-48780492d06f"
  Hint: Extension
  Value: js
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20160509T085839Z
